import React, { useState, useEffect } from "react";
import { TrendingData } from "@/entities/all";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import {
  BarChart,
  Bar,
  XAxis,
  YAxis,
  Tooltip,
  ResponsiveContainer,
  Cell,
} from "recharts";
import { TrendingUp, Briefcase, Building } from "lucide-react";

export default function Pulse() {
  const [trendingSkills, setTrendingSkills] = useState([]);
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    loadData();
  }, []);

  const loadData = async () => {
    setIsLoading(true);
    try {
      const skills = await TrendingData.filter(
        { type: "skill" },
        "-growth_percentage"
      );
      setTrendingSkills(skills);
    } catch (error) {
      console.error("Error loading trending data:", error);
    }
    setIsLoading(false);
  };
  
  const COLORS = [
    "#0ea5e9", "#6366f1", "#8b5cf6", "#a855f7", "#d946ef", 
    "#ec4899", "#f43f5e", "#ef4444"
  ];

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 via-blue-50/30 to-indigo-50/30 p-6">
      <div className="max-w-7xl mx-auto space-y-8">
        <div>
          <h1 className="text-3xl md:text-4xl font-bold text-slate-900 mb-2 flex items-center gap-3">
            <TrendingUp className="w-8 h-8 text-blue-600" />
            Industry Pulse
          </h1>
          <p className="text-slate-600 text-lg">
            Real-time insights into the job market's hottest trends.
          </p>
        </div>

        {isLoading ? (
          <p className="text-center">Loading industry data...</p>
        ) : (
          <div className="grid lg:grid-cols-2 gap-8">
            <Card className="lg:col-span-2 border-0 shadow-xl bg-white/80 backdrop-blur-sm">
              <CardHeader>
                <CardTitle className="text-xl font-bold text-slate-900 flex items-center gap-2">
                  <BarChart className="w-5 h-5" />
                  Top Trending Skills
                </CardTitle>
              </CardHeader>
              <CardContent className="h-[400px]">
                <ResponsiveContainer width="100%" height="100%">
                  <BarChart
                    data={trendingSkills}
                    layout="vertical"
                    margin={{ top: 5, right: 30, left: 20, bottom: 5 }}
                  >
                    <XAxis type="number" hide />
                    <YAxis
                      type="category"
                      dataKey="name"
                      width={120}
                      tick={{ fill: "#475569", fontSize: 12 }}
                      axisLine={false}
                      tickLine={false}
                    />
                    <Tooltip
                      cursor={{ fill: 'rgba(239, 246, 255, 0.5)' }}
                      contentStyle={{
                        background: 'white',
                        border: '1px solid #e2e8f0',
                        borderRadius: '0.5rem'
                      }}
                    />
                    <Bar dataKey="growth_percentage" name="Growth" unit="%" radius={[0, 4, 4, 0]}>
                      {trendingSkills.map((entry, index) => (
                        <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
                      ))}
                    </Bar>
                  </BarChart>
                </ResponsiveContainer>
              </CardContent>
            </Card>

            <Card className="border-0 shadow-xl bg-white/80 backdrop-blur-sm">
              <CardHeader>
                <CardTitle className="text-xl font-bold text-slate-900 flex items-center gap-2">
                  <Briefcase className="w-5 h-5" />
                  In-Demand Job Roles
                </CardTitle>
              </CardHeader>
              <CardContent className="space-y-3">
                {/* Placeholder data */}
                {[
                  { name: "AI Engineer", growth: "120%" },
                  { name: "Cloud Architect", growth: "95%" },
                  { name: "Data Privacy Officer", growth: "88%" },
                  { name: "DevOps Engineer", growth: "75%" },
                ].map((role) => (
                  <div key={role.name} className="flex justify-between items-center p-2 rounded-lg hover:bg-slate-50">
                    <span className="font-medium text-slate-800">{role.name}</span>
                    <span className="text-green-600 font-semibold">{role.growth}</span>
                  </div>
                ))}
              </CardContent>
            </Card>

            <Card className="border-0 shadow-xl bg-white/80 backdrop-blur-sm">
              <CardHeader>
                <CardTitle className="text-xl font-bold text-slate-900 flex items-center gap-2">
                  <Building className="w-5 h-5" />
                  Top Hiring Companies
                </CardTitle>
              </CardHeader>
              <CardContent className="space-y-3">
                {/* Placeholder data */}
                {[
                  { name: "Nvidia", field: "AI & Graphics" },
                  { name: "OpenAI", field: "AI Research" },
                  { name: "Scale AI", field: "Data Labeling" },
                  { name: "Databricks", field: "Data & AI" },
                ].map((company) => (
                  <div key={company.name} className="flex items-center gap-3 p-2 rounded-lg hover:bg-slate-50">
                    <div className="w-8 h-8 bg-slate-200 rounded-md flex items-center justify-center font-bold text-slate-600">
                      {company.name[0]}
                    </div>
                    <div>
                      <p className="font-medium text-slate-800">{company.name}</p>
                      <p className="text-sm text-slate-500">{company.field}</p>
                    </div>
                  </div>
                ))}
              </CardContent>
            </Card>
          </div>
        )}
      </div>
    </div>
  );
}